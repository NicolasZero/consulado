<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= title %>
    </title>
    <%- include('includes/head') %>
    <link rel="stylesheet" href="/css/msg.css">

    <style>
        .btn-chat, .btn-ws{
            display: none;
        }

    </style>


    <script type="module">
        import { io } from 'https://cdn.socket.io/4.3.2/socket.io.esm.min.js'

        const username = 'Operator'
        const socket = io(
            {
                auth:{
                    username: username
                }
            }
        );

        const form = document.getElementById('form')
        const chat = document.getElementById('chat-body')
        
        socket.on('chat message', (msg) => {
            const div = document.createElement('div')
            if (msg.username === username) {
                div.classList.add('msg', 'msg-own')
                div.innerHTML = `<span>Yo</span><p>${msg.msg}</p>`
            }else{
                div.classList.add('msg', 'msg-other')
                div.innerHTML = `<span>${msg.username}</span><p>${msg.msg}</p>`
            }
            chat.appendChild(div)
            chat.scrollTop = chat.scrollHeight
        })

        form.addEventListener('submit', (e) => {
            e.preventDefault()
            const msg = document.getElementById('msg')
            if (msg.value) {
                socket.emit('chat message', msg.value)
                msg.value = ''
            }
        })

        const changeChannel = (channel) => {
            // socket.emit('join',`channel-${channel}`);
            // console.log(channel);
        }

        document.querySelector('.list-group-item').addEventListener('click', changeChannel(1))
    </script>
</head>

<body>
    <%- include('includes/nav') %>

    <main class="p-0 row m-0 px-1 px-md-3 justify-content-center" style="background-color: #ffe7f5;">

        <!-- sidebar -->
        <aside class="col p-0 bg-body-tertiary">
            <header class="bg-primary py-3 text-center">
                <h4 class="fs-3 fw-light m-0 text-white">Salas</h4>
            </header>

            <div class="h-100 border-end">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item list-group-item-action">Sala 1</li>
                    <li class="list-group-item list-group-item-action">Sala 2</li>
                    <li class="list-group-item list-group-item-action">Sala 3</li>
                    <li class="list-group-item list-group-item-action">Sala 4</li>
                    <!-- <li class="list-group-item list-group-item-action">Sala 5</li> -->
                </ul>
            </div>
        </aside>

        <!-- chat -->
        <section class="col-12 col-md-8 col-lg-8 p-0 bg-body-tertiary d-none d-md-block">
            <header class="bg-primary py-3 text-center">
                <h4 class="fs-3 fw-light m-0 text-white">Conversación</h4>
            </header>

            <p class="text-center border-bottom"><b>Nota:</b> Esta área es solo de pruebas. Pruebe enviar un mensaje.</p>

            <section id="chat-body" class="msg-panel d-flex flex-column p-3 border-bottom">
            </section>

            <form class="input-group p-3" id="form">
                <button class="input-group-text" id="basic-addon1">
                    <i class="bi bi-send-fill text-secondary"></i>
                </button>
                <input type="text" class="form-control" placeholder="Enviar un mensaje" name="msg" id="msg">
            </form>
        </section>
    </main>

    <%- include('includes/footer') %>
</body>

</html>
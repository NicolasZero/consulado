<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= title %>
    </title>
    <%- include('includes/head') %>
    <link rel="stylesheet" href="/css/msg.css">


    <script type="module">
        import { io } from 'https://cdn.socket.io/4.3.2/socket.io.esm.min.js'
        const username = 'Anonymous'
        const socket = io(
            {
                auth:{
                    username: username
                }
            }
        );

        const form = document.getElementById('form')
        const chat = document.getElementById('chat-body')
        
        socket.on('chat message', (msg) => {
            const div = document.createElement('div')
            if (msg.username === username) {
                div.classList.add('msg', 'msg-own')
                div.innerHTML = `<span>Yo</span><p>${msg.msg}</p>`
            }else{
                div.classList.add('msg', 'msg-other')
                div.innerHTML = `<span>${msg.username}</span><p>${msg.msg}</p>`
            }
            chat.appendChild(div)
            chat.scrollTop = chat.scrollHeight
        })

        form.addEventListener('submit', (e) => {
            e.preventDefault()
            const msg = document.getElementById('msg')
            if (msg.value) {
                socket.emit('chat message', msg.value)
                msg.value = ''
            }
        })
    </script>
</head>

<body>
    <%- include('includes/nav') %>

    <div class="p-0 row m-0 p-0 justify-content-center" style="background-color: #ffe7f5;">

        <div class="col-12 col-md-10 col-lg-8 p-0 bg-body-tertiary">

            <div class="bg-primary p-3 text-center">
                <h4 class="fs-3 fw-light m-0 text-white">Atenci√≥n en vivo</h4>
            </div>

            <div class="text-center">
                <p>Pruebe escribir un mensaje <br><b>Nota:</b> Los mensajes no son guardados</p>
            </div>

            <div id="chat-body" class="msg-panel d-flex flex-column p-3 border-top border-bottom">
            </div>

            <form class="input-group p-3" id="form">
                <button class="input-group-text" id="basic-addon1">
                    <i class="bi bi-send-fill text-secondary"></i>
                </button>
                <input type="text" class="form-control" placeholder="Enviar un mensaje" name="msg" id="msg">
            </form>
        </div>
    </div>

    <%- include('includes/footer') %>
</body>

</html>